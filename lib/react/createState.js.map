{"version":3,"file":"createState.js","sources":["react/createState.js"],"sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nrequire(\"core-js/modules/es.array.concat\");\n\nrequire(\"core-js/modules/es.array.for-each\");\n\nrequire(\"core-js/modules/es.function.bind\");\n\nrequire(\"core-js/modules/es.object.assign\");\n\nrequire(\"core-js/modules/web.dom-collections.for-each\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _objectWithoutProperties2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectWithoutProperties\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _immutable = _interopRequireDefault(require(\"../util/immutable\"));\n\nvar _createStore = _interopRequireDefault(require(\"../state/createStore\"));\n\nvar _applyMiddleware = _interopRequireDefault(require(\"../state/applyMiddleware\"));\n\nvar _middleware = require(\"../middleware\");\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n/**\n * registerModels\n * @param models\n * @param saga\n */\nfunction registerModels(_ref) {\n  var saga = _ref.saga,\n      models = _ref.models;\n  models.forEach(function (model) {\n    saga.model(model);\n  });\n}\n/**\n * createState\n * @param initialState - state初始化数据\n * @param models - 所有的模型\n * @param mapState - mapState\n * @param mapDispatch - mapDispatch\n * @param ref - React组件的this\n * @param middleWares - 中间件\n * @param reducer - reducer\n */\n\n\nvar _default = function _default(_ref2) {\n  var initialState = _ref2.initialState,\n      _ref2$models = _ref2.models,\n      models = _ref2$models === void 0 ? [] : _ref2$models,\n      mapState = _ref2.mapState,\n      mapDispatch = _ref2.mapDispatch,\n      ref = _ref2.ref,\n      middleWares = _ref2.middleWares,\n      reducer = _ref2.reducer;\n\n  /**\n   * mapTo\n   * @return {{dispatch: {}, props: {}}}\n   */\n  function mapTo() {\n    var dispatch = {}; // mapDispatchToProps\n\n    if (mapDispatch) {\n      // eslint-disable-next-line @typescript-eslint/no-use-before-define\n      dispatch = mapDispatch(store.dispatch.bind(store));\n    }\n\n    var props = {}; // mapStateToProps\n\n    if (mapState) {\n      // eslint-disable-next-line @typescript-eslint/no-use-before-define\n      props = mapState(store.getState());\n    }\n\n    return {\n      dispatch: dispatch,\n      props: props\n    };\n  }\n  /**\n   * onSubscribe\n   * @param action\n   */\n\n\n  function onSubscribe(action) {\n    var _mapTo = mapTo(),\n        props = _mapTo.props,\n        dispatch = _mapTo.dispatch;\n\n    ref.setState(_objectSpread(_objectSpread({}, props), dispatch), function () {\n      // 如果是当前实力进行的数据更改才会调用success\n      var success = action.success,\n          other = (0, _objectWithoutProperties2[\"default\"])(action, [\"success\"]); // console.log('redux进行了数据改变的通知');\n      // console.log(action);\n      // console.log(this.ins);\n      // console.log(this.ins === ins);\n\n      if (success) {\n        success.call(ref, _immutable[\"default\"].cloneDeep(other));\n      }\n    });\n  } // saga对象\n\n\n  var saga = (0, _middleware.createSagaMiddleware)(); // store对象\n\n  var store = (0, _createStore[\"default\"])(reducer, initialState, _applyMiddleware[\"default\"].apply(void 0, (0, _toConsumableArray2[\"default\"])(middleWares).concat([saga]))); // store注册subscribe\n\n  var unsubscribe = store.subscribe(onSubscribe); // 注册models\n\n  registerModels({\n    models: models,\n    saga: saga\n  }); // 初始化ref的state\n\n  if (!ref.state) {\n    // eslint-disable-next-line no-param-reassign\n    ref.state = {};\n  }\n\n  var _mapTo2 = mapTo(),\n      props = _mapTo2.props,\n      dispatch = _mapTo2.dispatch;\n\n  Object.assign(ref.state, props, dispatch, {\n    dispatch: store.dispatch.bind(store)\n  });\n  return function () {\n    unsubscribe();\n  };\n};\n\nexports[\"default\"] = _default;"],"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","_toConsumableArray2","_objectWithoutProperties2","_defineProperty2","_immutable","_createStore","_applyMiddleware","_middleware","ownKeys","object","enumerableOnly","symbols","keys","getOwnPropertySymbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","getOwnPropertyDescriptors","defineProperties","registerModels","_ref","saga","models","model","_default","_ref2","initialState","_ref2$models","mapState","mapDispatch","ref","middleWares","reducer","mapTo","dispatch","store","bind","props","getState","createSagaMiddleware","concat","unsubscribe","subscribe","action","_mapTo","setState","success","other","call","cloneDeep","state","_mapTo2","assign"],"mappings":"aAEA,IAAIA,uBAAyBC,QAAQ,gDAErCA,QAAQ,mCAERA,QAAQ,qCAERA,QAAQ,oCAERA,QAAQ,oCAERA,QAAQ,gDAERC,OAAOC,eAAeC,QAAS,aAAc,CAC3CC,OAAO,IAETD,QAAiB,aAAI,EAErB,IAAIE,oBAAsBN,uBAAuBC,QAAQ,6CAErDM,0BAA4BP,uBAAuBC,QAAQ,mDAE3DO,iBAAmBR,uBAAuBC,QAAQ,0CAElDQ,WAAaT,uBAAuBC,QAAQ,sBAE5CS,aAAeV,uBAAuBC,QAAQ,yBAE9CU,iBAAmBX,uBAAuBC,QAAQ,6BAElDW,YAAcX,QAAQ,iBAE1B,SAASY,QAAQC,EAAQC,GAAkB,IAAwEC,EAApEC,EAAOf,OAAOe,KAAKH,GAAqQ,OAAxPZ,OAAOgB,wBAA6BF,EAAUd,OAAOgB,sBAAsBJ,GAAaC,IAAgBC,EAAUA,EAAQG,OAAO,SAAUC,GAAO,OAAOlB,OAAOmB,yBAAyBP,EAAQM,GAAKE,cAAgBL,EAAKM,KAAKC,MAAMP,EAAMD,IAAmBC,EAE9U,SAASQ,cAAcC,GAAU,IAAK,IAAIC,EAAI,EAAGA,EAAIC,UAAUC,OAAQF,IAAK,CAAE,IAAIG,EAAyB,MAAhBF,UAAUD,GAAaC,UAAUD,GAAK,GAAQA,EAAI,EAAKd,QAAQX,OAAO4B,IAAS,GAAMC,QAAQ,SAAUC,IAAO,EAAIxB,iBAA0B,SAAGkB,EAAQM,EAAKF,EAAOE,MAAsB9B,OAAO+B,0BAA6B/B,OAAOgC,iBAAiBR,EAAQxB,OAAO+B,0BAA0BH,IAAmBjB,QAAQX,OAAO4B,IAASC,QAAQ,SAAUC,GAAO9B,OAAOC,eAAeuB,EAAQM,EAAK9B,OAAOmB,yBAAyBS,EAAQE,MAAe,OAAON,EAO9hB,SAASS,eAAeC,GACtB,IAAIC,EAAOD,EAAKC,KACHD,EAAKE,OACXP,QAAQ,SAAUQ,GACvBF,EAAKE,MAAMA,KAef,IAAIC,SAAW,SAAkBC,GAC/B,IAAIC,EAAeD,EAAMC,aACrBC,EAAeF,EAAMH,OACrBA,OAA0B,IAAjBK,EAA0B,GAAKA,EACxCC,EAAWH,EAAMG,SACjBC,EAAcJ,EAAMI,YACpBC,EAAML,EAAMK,IACZC,EAAcN,EAAMM,YACpBC,EAAUP,EAAMO,QAMpB,SAASC,IACP,IAAIC,EAAW,GAEXL,IAEFK,EAAWL,EAAYM,EAAMD,SAASE,KAAKD,KAG7C,IAAIE,EAAQ,GAOZ,OALIT,IAEFS,EAAQT,EAASO,EAAMG,aAGlB,CACLJ,SAAUA,EACVG,MAAOA,GA6BX,IAAIhB,GAAO,EAAIzB,YAAY2C,wBAEvBJ,GAAQ,EAAIzC,aAAsB,SAAGsC,EAASN,EAAc/B,iBAA0B,QAAEa,WAAM,GAAQ,EAAIlB,oBAA6B,SAAGyC,GAAaS,OAAO,CAACnB,MAE/JoB,EAAcN,EAAMO,UAxBxB,SAAqBC,GACnB,IACIN,GADAO,EAASX,KACMI,MACfH,EAAWU,EAAOV,SAEtBJ,EAAIe,SAASpC,cAAcA,cAAc,GAAI4B,GAAQH,GAAW,WAE9D,IAAIY,EAAUH,EAAOG,QACjBC,GAAQ,EAAIxD,0BAAmC,SAAGoD,EAAQ,CAAC,YAK3DG,GACFA,EAAQE,KAAKlB,EAAKrC,WAAoB,QAAEwD,UAAUF,QAYxD5B,eAAe,CACbG,OAAQA,EACRD,KAAMA,IAGHS,EAAIoB,QAEPpB,EAAIoB,MAAQ,IAGVC,EAAUlB,IACVI,EAAQc,EAAQd,MAChBH,EAAWiB,EAAQjB,SAKvB,OAHAhD,OAAOkE,OAAOtB,EAAIoB,MAAOb,EAAOH,EAAU,CACxCA,SAAUC,EAAMD,SAASE,KAAKD,KAEzB,WACLM,MAIJrD,QAAiB,QAAIoC"}