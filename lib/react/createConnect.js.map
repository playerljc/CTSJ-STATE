{"version":3,"file":"createConnect.js","sources":["react/createConnect.js"],"sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _objectWithoutProperties2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectWithoutProperties\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _lodash = _interopRequireDefault(require(\"lodash\"));\n\nvar _Context = require(\"./Context\");\n\nvar _immutable = _interopRequireDefault(require(\"../util/immutable\"));\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2[\"default\"])(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2[\"default\"])(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2[\"default\"])(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\n/**\n * createConnect\n * @param {Function} - mapStateToProps\n * @param {Function} - mapDispatchToProps\n * @return {HOC}\n */\nvar _default = function _default(mapStateToProps, mapDispatchToProps) {\n  return (\n    /**\n     * ConnectHOC\n     * @param {ReactElement} - Component\n     */\n    function (Component) {\n      var _temp;\n\n      return _temp = /*#__PURE__*/function (_React$Component) {\n        (0, _inherits2[\"default\"])(_temp, _React$Component);\n\n        var _super = _createSuper(_temp);\n\n        function _temp(props) {\n          var _this;\n\n          (0, _classCallCheck2[\"default\"])(this, _temp);\n          _this = _super.call(this, props);\n          (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"onSubscribe\", function (action) {\n            var _assertThisInitialize = (0, _assertThisInitialized2[\"default\"])(_this),\n                store = _assertThisInitialize.store; // store的数据\n\n\n            var state = store.getState(); // 之前state的数据\n\n            var cloneState = JSON.parse(JSON.stringify(_this.state.state || {}));\n\n            _this.setState({\n              state: _lodash[\"default\"].merge(cloneState, state)\n            }, function () {\n              // 如果是当前实力进行的数据更改才会调用success\n              var success = action.success,\n                  ins = action.ins,\n                  other = (0, _objectWithoutProperties2[\"default\"])(action, [\"success\", \"ins\"]); // console.log('redux进行了数据改变的通知');\n              // console.log(action);\n              // console.log(this.ins);\n              // console.log(this.ins === ins);\n\n              if (success && ins) {\n                if (_this.ins === ins) {\n                  success.call(ins, _immutable[\"default\"].cloneDeep(other));\n                }\n              }\n            });\n          });\n          _this.state = {\n            state: null\n          };\n          return _this;\n        }\n\n        (0, _createClass2[\"default\"])(_temp, [{\n          key: \"componentDidMount\",\n          value: function componentDidMount() {\n            var store = this.store;\n            this.unsubscribe = store.subscribe(this.onSubscribe);\n          }\n        }, {\n          key: \"componentWillUnmount\",\n          value: function componentWillUnmount() {\n            this.unsubscribe();\n          }\n        }, {\n          key: \"getInstance\",\n\n          /**\n           * getInstance\n           * @return {ReactElement}\n           */\n          value: function getInstance() {\n            return this.ins;\n          }\n        }, {\n          key: \"render\",\n          value: function render() {\n            var _this2 = this;\n\n            return /*#__PURE__*/_react[\"default\"].createElement(_Context.ProviderContext.Consumer, null, function (_ref) {\n              var store = _ref.store;\n              if (!_this2.store) _this2.store = store;\n              var state = _this2.state.state ? _this2.state.state : _this2.store.getState();\n              var dispatch = {};\n\n              if (mapDispatchToProps) {\n                dispatch = mapDispatchToProps(_this2.store.dispatch.bind(_this2.store));\n              }\n\n              var props = {};\n\n              if (mapStateToProps) {\n                props = mapStateToProps(state);\n              }\n\n              console.log(_this2.state);\n              return /*#__PURE__*/_react[\"default\"].createElement(Component, (0, _extends2[\"default\"])({\n                ref: function ref(ins) {\n                  _this2.ins = ins;\n                }\n              }, _this2.props, props, dispatch, {\n                dispatch: store.dispatch\n              }));\n            });\n          }\n        }]);\n        return _temp;\n      }(_react[\"default\"].Component), _temp;\n    }\n  );\n};\n\nexports[\"default\"] = _default;"],"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","_extends2","_objectWithoutProperties2","_classCallCheck2","_createClass2","_assertThisInitialized2","_inherits2","_possibleConstructorReturn2","_getPrototypeOf2","_defineProperty2","_react","_lodash","_Context","_immutable","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","NewTarget","result","Super","this","constructor","Reflect","construct","arguments","apply","sham","Proxy","Date","prototype","toString","call","e","_default","mapStateToProps","mapDispatchToProps","Component","_React$Component","_temp","_super","props","_this","action","state","store","getState","cloneState","JSON","parse","stringify","setState","merge","success","ins","other","cloneDeep","key","unsubscribe","subscribe","onSubscribe","_this2","createElement","ProviderContext","Consumer","_ref","dispatch","bind","console","log","ref"],"mappings":"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"}