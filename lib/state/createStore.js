"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");require("core-js/modules/es.array.for-each"),require("core-js/modules/es.array.index-of"),require("core-js/modules/es.array.splice"),require("core-js/modules/es.function.bind"),require("core-js/modules/es.object.to-string"),require("core-js/modules/es.promise"),require("core-js/modules/web.dom-collections.for-each"),Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));function ownKeys(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){(0,_defineProperty2.default)(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function trigger(t){this.listeners.forEach(function(e){e(t)})}var Store=function(){function i(e){var t=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];(0,_classCallCheck2.default)(this,i),this.reducer=e||function(e){return e},this.state=_objectSpread({},r),this.middlewares=n||[],this.middlewares.forEach(function(e){e.setStore(t)}),this.listeners=[]}return(0,_createClass2.default)(i,[{key:"getState",value:function(){return this.state}},{key:"runBeforeMiddleWares",value:function(i){var s=this;return new Promise(function(e,t){var n=s.middlewares.length-1;(function r(){return new Promise(function(e,t){n<0?e():s.middlewares[n--].before({state:s.state,action:i}).then(function(){r().then(function(){e()})}).catch(function(e){t(e)})})})().then(function(){e()}).catch(function(e){t(e)})})}},{key:"runAfterMiddleWares",value:function(i){var s=this;return new Promise(function(e,t){var n=0;(function r(){return new Promise(function(e,t){n>=s.middlewares.length?e():s.middlewares[n++].after({state:s.state,action:i}).then(function(){r().then(function(){e()})}).catch(function(e){t(e)})})})().then(function(){e()}).catch(function(e){t(e)})})}},{key:"dispatch",value:function(t){var r=this;t instanceof Function?t(this.dispatch.bind(this)):this.middlewares.length?this.runBeforeMiddleWares(t).then(function(){t.success;var e=(0,_objectWithoutProperties2.default)(t,["success"]);trigger.call(r,e),r.state=r.reducer(r.state,t),r.runAfterMiddleWares(t).then(function(){trigger.call(r,t)})}):(this.state=this.reducer(this.state,t),trigger.call(this,t))}},{key:"subscribe",value:function(t){var r=this;return this.listeners.push(t),function(){var e=r.listeners.indexOf(t);-1!==e&&r.listeners.splice(e,1)}}}]),i}(),_default=function(e,t,r){return new Store(e,t,r)};exports.default=_default;
//# sourceMappingURL=createStore.js.map
